{% extends 'T&P_Dashboard.html' %}
{% load static %}
{% with section='invitations' page='update_response' %}
{% block title %}Update Invitation Response{% endblock title %}

{% block content %}
    <!-- Main Layout -->
    <div class="update-response-layout">
        <h1 class="update-response-header">Update Invitation Response</h1>
        <a href="{% url 'tpportal' %}" class="update-response-back-button">‚Üê Back</a>

        <!-- Select Invitation -->
        <div class="update-response-select-section">
        <form method="get">
            <label class="update-response-select-label">Select Invitation:</label>
            <select name="invitation_key" class="update-response-select" onchange="this.form.submit()">
            <option value="">-- Choose an invitation --</option>
            {% for invitation in invitations %}
                {% with invitation.company.name as name %}
                {% with invitation.company.company_id as cid %}
                    <option value="{{ cid }}|{{ invitation.invited_date }}|{{ invitation.job_profile }}|{{ invitation.job_offer }}"
                    {% if selected_invite and invitation == selected_invite %}selected{% endif %}>
                    {{ name }} | {{ invitation.job_profile }} | {{ invitation.job_offer }} | {{ invitation.invited_date }}
                    </option>
                {% endwith %}
                {% endwith %}
            {% endfor %}
            </select>
        </form>
        </div>

        {% if selected_invite %}
        <div class="update-response-current-section">
            <h3 class="update-response-current-title">
            Current Response: {{ selected_invite.response|default:"Pending" }}
            </h3>
        </div>

        <!-- Update Form -->
        <div class="update-response-form-section">
            <form method="post">
            {% csrf_token %}
            <!-- Hidden fields -->
            <input type="hidden" name="company_id" value="{{ selected_invite.company.company_id }}">
            <input type="hidden" name="invited_date" value="{{ selected_invite.invited_date }}">
            <input type="hidden" name="job_profile" value="{{ selected_invite.job_profile }}">
            <input type="hidden" name="job_offer" value="{{ selected_invite.job_offer }}">

            <div class="update-response-form-group">
                <label for="new_response" class="update-response-form-label">Update Response:</label>
                <select name="new_response" class="update-response-form-select" required>
                <option value="">-- Select Response --</option>
                {% for choice in response_choices %}
                    <option value="{{ choice }}" {% if selected_invite.response == choice %}selected{% endif %}>{{ choice }}</option>
                {% endfor %}
                </select>
            </div>

            <button type="submit" class="update-response-submit-button">Update</button>
            </form>
        </div>
        {% endif %}
    </div>
{% endblock content %}
{% endwith %}
